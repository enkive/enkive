<?xml version="1.0" encoding="UTF-8"?>

<project name="Enkive EDiscovery" default="package" basedir=".">
	<property file="build.properties" />

	<fail unless="ediscovery.web.dir">Please set ediscovery.web.dir property.</fail>
	<fail unless="ediscovery.war">Please set ediscovery.war property.</fail>
	<fail unless="jdk1.6.dir">Please set jdk1.6.dir property.</fail>

	<property name="label" value="Enkive EDiscovery" />
	<property name="project.dir" value="." />
	<property name="build.dir" value="${project.dir}/build" />
	<property name="source.dir" value="${project.dir}/src" />
	<property name="bin.dir" value="${project.dir}/bin" />
	<property name="lib.dir" value="${project.dir}/WEB-INF/lib" />
	<property name="project.name" value="ediscovery" />
	<property name="package.file.zip" value="${build.dir}/${project.name}.zip" />
	<property name="package.file.jar" value="${build.dir}/${project.name}.jar" />
	<property name="package.file.war" value="${build.dir}/${project.name}.war" />
	
	<path id="classpath.libs">
		<fileset dir="${lib.dir}" includes="*.jar" />
	</path>

	<path id="classpath.build">
		<fileset dir="${build.dir}" includes="**/*.jar" />
	</path>

	<path id="jdk1.6">
		<fileset dir="${jdk1.6.dir}/jre/lib" includes="*.jar" />
		<fileset dir="${jdk1.6.dir}/lib" includes="*.jar" />
	</path>

	<target name="clean" description="Removes all generated files">
		<delete dir="${bin.dir}" />
		<delete dir="${build.dir}" />
	</target>

	<target name="setup" depends="clean" description="Creates the ${build.dir} and ${bin.dir} directories">
		<mkdir dir="${bin.dir}" />
		<mkdir dir="${build.dir}" />
	</target>

	<target name="package" depends="setup, package-jar" description="Creates a zip called ${package.file.zip} which can be unzipped on top of an exploded web app">
		<delete file="${package.file.zip}" />
		<zip destfile="${package.file.zip}" update="true">
			<zipfileset file="${package.file.jar}" prefix="WEB-INF/lib" />
			<zipfileset dir="./css" prefix="css" />
			<zipfileset dir="./images" prefix="images" />
			<zipfileset dir="./javascript" prefix="javascript" />
			<zipfileset dir="./WEB-INF" prefix="WEB-INF" />
		</zip>
	</target>

	<target name="compile" description="Compiles src to ${bin.dir}">
		<mkdir dir="${bin.dir}" />
		<javac srcdir="${source.dir}/java" destdir="${bin.dir}" source="1.6" target="1.6" debug="on" fork="yes" deprecation="on" includeantruntime="false" bootclasspathref="jdk1.6">
			<classpath refid="classpath.libs" />
		</javac>
	</target>

	<target name="package-jar" depends="compile" description="Jars up the compiled classes and ${web.dir}/META-INF into ${package.file.jar}">
		<delete file="${package.file.jar}" />
		<jar destfile="${package.file.jar}">
			<fileset dir="${bin.dir}" includes="com/**" />
			<fileset dir="${bin.dir}" includes="org/**" />
		</jar>
	</target>

	<target name="deploy" depends="package" description="Unzips the ${package.file.zip} into ${ediscovery.web.dir}">
		<unzip src="${package.file.zip}" dest="${ediscovery.web.dir}" />
	</target>

	<target name="package-war" depends="package" description="Packages the project into a WAR file">
		<unzip src="${package.file.zip}" dest="${build.dir}/ediscovery" />
		<war file="${package.file.war}" webxml="${build.dir}/ediscovery/WEB-INF/web.xml">
			<fileset dir="${build.dir}/ediscovery/" />
		</war>
	</target>

	<target name="deploy-war" depends="package-war" description="Copies the ${package.file.war} into ${ediscovery.war}">
		<copy file="${package.file.war}" tofile="${ediscovery.war}" />
		<delete dir="${ediscovery.web.dir}" />
	</target>

</project>
